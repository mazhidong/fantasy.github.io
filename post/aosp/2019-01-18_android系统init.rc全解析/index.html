<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Androidç³»ç»Ÿinit.rcå…¨è§£æ - Fantasy Blogs</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Fantasy" />
  <meta name="description" content="è¿™æ˜¯ä¸€ç¯‡ç”¨å¿ƒå†™çš„åšå®¢ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç”¨å¿ƒçœ‹å¹¶å¸®å¿™æ‰¾åˆ°æ–‡ç« çš„æ”¹è¿›ä¹‹å¤„ï¼Œè°¢è°¢ï¼› æœåŠ¡å¯åŠ¨æœºåˆ¶ system/core/init/init.cæ–‡ä»¶main" />

  <meta name="keywords" content="mzd, fantasy, blogs" />






<meta name="generator" content="Hugo 0.40" />


<link rel="canonical" href="https://mazhidong.github.io/post/aosp/2019-01-18_android%E7%B3%BB%E7%BB%9Finit.rc%E5%85%A8%E8%A7%A3%E6%9E%90/" />



<link rel="icon" href="/favicon.ico" />










<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">




<meta property="og:title" content="Androidç³»ç»Ÿinit.rcå…¨è§£æ" />
<meta property="og:description" content="è¿™æ˜¯ä¸€ç¯‡ç”¨å¿ƒå†™çš„åšå®¢ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç”¨å¿ƒçœ‹å¹¶å¸®å¿™æ‰¾åˆ°æ–‡ç« çš„æ”¹è¿›ä¹‹å¤„ï¼Œè°¢è°¢ï¼› æœåŠ¡å¯åŠ¨æœºåˆ¶ system/core/init/init.cæ–‡ä»¶main" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://mazhidong.github.io/post/aosp/2019-01-18_android%E7%B3%BB%E7%BB%9Finit.rc%E5%85%A8%E8%A7%A3%E6%9E%90/" />



<meta property="article:published_time" content="2019-01-18T00:00:00&#43;00:00"/>

<meta property="article:modified_time" content="2019-01-18T00:00:00&#43;00:00"/>











<meta itemprop="name" content="Androidç³»ç»Ÿinit.rcå…¨è§£æ">
<meta itemprop="description" content="è¿™æ˜¯ä¸€ç¯‡ç”¨å¿ƒå†™çš„åšå®¢ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç”¨å¿ƒçœ‹å¹¶å¸®å¿™æ‰¾åˆ°æ–‡ç« çš„æ”¹è¿›ä¹‹å¤„ï¼Œè°¢è°¢ï¼› æœåŠ¡å¯åŠ¨æœºåˆ¶ system/core/init/init.cæ–‡ä»¶main">


<meta itemprop="datePublished" content="2019-01-18T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-01-18T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="8452">



<meta itemprop="keywords" content="android," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Androidç³»ç»Ÿinit.rcå…¨è§£æ"/>
<meta name="twitter:description" content="è¿™æ˜¯ä¸€ç¯‡ç”¨å¿ƒå†™çš„åšå®¢ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç”¨å¿ƒçœ‹å¹¶å¸®å¿™æ‰¾åˆ°æ–‡ç« çš„æ”¹è¿›ä¹‹å¤„ï¼Œè°¢è°¢ï¼› æœåŠ¡å¯åŠ¨æœºåˆ¶ system/core/init/init.cæ–‡ä»¶main"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Fantasy</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/about/">About</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Fantasy
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/">Home</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/post/">Archives</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/tags/">Tags</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/categories/">Categories</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://mazhidong.github.io/about/">About</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Androidç³»ç»Ÿinit.rcå…¨è§£æ</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2019-01-18 </span>
        <div class="post-category">
            <a href="https://mazhidong.github.io/categories/android/"> android </a>
            
          </div>
        <span class="more-meta"> çº¦ 8452 å­— </span>
        <span class="more-meta"> é¢„è®¡é˜…è¯» 17 åˆ†é’Ÿ </span>
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#æœåŠ¡å¯åŠ¨æœºåˆ¶">æœåŠ¡å¯åŠ¨æœºåˆ¶</a></li>
<li><a href="#init-rc-ç®€ä»‹">init.rc ç®€ä»‹</a></li>
<li><a href="#init-rcè¯­æ³•ç»“æ„è§£æ">init.rcè¯­æ³•ç»“æ„è§£æ</a></li>
<li><a href="#actions">Actions</a></li>
<li><a href="#triggers-è§¦å‘å™¨">Triggersï¼ˆè§¦å‘å™¨ï¼‰</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#init-rcæ–‡ä»¶è¯¦è§£">init.rcæ–‡ä»¶è¯¦è§£</a></li>
<li><a href="#init-cå…¨è§£æ">init.cå…¨è§£æ</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<p>è¿™æ˜¯ä¸€ç¯‡ç”¨å¿ƒå†™çš„åšå®¢ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç”¨å¿ƒçœ‹å¹¶å¸®å¿™æ‰¾åˆ°æ–‡ç« çš„æ”¹è¿›ä¹‹å¤„ï¼Œè°¢è°¢ï¼›</p>

<h2 id="æœåŠ¡å¯åŠ¨æœºåˆ¶">æœåŠ¡å¯åŠ¨æœºåˆ¶</h2>

<ol>
<li>system/core/init/init.cæ–‡ä»¶mainå‡½æ•°ä¸­parse_config_file(init.rc)è¯»å–å¹¶è§£æinit.rcæ–‡ä»¶å†…å®¹ã€‚å°†serviceä¿¡æ¯æ”¾ç½®åˆ°system/core/init/init_parser.cppçš„service_listä¸­</li>
<li>system/core/init/init.cæ–‡ä»¶mainå‡½æ•°ç»§ç»­æ‰§è¡Œrestart_servie_if_needed(â€¦) -&gt; service_start(â€¦) -&gt; Execve(â€¦)å»ºç«‹serviceè¿›ç¨‹ï¼›</li>
</ol>

<p>ä¸ºäº†è®©å¤§ä¼™çœ‹å¾—æ›´æ˜ç™½ï¼Œä¸Šä¸ªå›¾å…ˆã€Šæ€»ä½“å¯åŠ¨æ¡†æ¶å›¾ã€‹ï¼š
<img src="https://raw.githubusercontent.com/mazhidong/Picture/master/Blog/2019-01-18/init.png" alt="" /></p>

<h2 id="init-rc-ç®€ä»‹">init.rc ç®€ä»‹</h2>

<p>ç›®å‰Linuxæœ‰å¾ˆå¤šé€šè®¯æœºåˆ¶å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¹‹é—´äº¤äº’ï¼Œä¾‹å¦‚è®¾å¤‡é©±åŠ¨æ–‡ä»¶ï¼ˆä½äº/devç›®å½•ä¸­ï¼‰ã€å†…å­˜æ–‡ä»¶ï¼ˆ/procã€/sysç›®å½•ç­‰ï¼‰ã€‚äº†è§£Linuxçš„åŒå­¦éƒ½åº”è¯¥çŸ¥é“Linuxçš„é‡è¦ç‰¹å¾ä¹‹ä¸€å°±æ˜¯ä¸€åˆ‡éƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨çš„ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªè®¾å¤‡é€šå¸¸ä¸ä¸€ä¸ªæˆ–å¤šä¸ªè®¾å¤‡æ–‡ä»¶å¯¹åº”ã€‚è¿™äº›ä¸å†…æ ¸ç©ºé—´äº¤äº’çš„æ–‡ä»¶éƒ½åœ¨ç”¨æˆ·ç©ºé—´ï¼Œæ‰€ä»¥åœ¨Linuxå†…æ ¸è£…è½½å®Œï¼Œéœ€è¦é¦–å…ˆå»ºç«‹è¿™äº›æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚è€Œå®Œæˆè¿™äº›å·¥ä½œçš„ç¨‹åºå°±æ˜¯æœ¬æ–‡è¦ä»‹ç»çš„initã€‚Initæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œç¨‹åºã€‚å…¶ä¸»è¦å·¥ä½œä¹‹ä¸€å°±æ˜¯å»ºç«‹è¿™äº›ä¸å†…æ ¸ç©ºé—´äº¤äº’çš„æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚å½“Linuxå†…æ ¸åŠ è½½å®Œåï¼Œè¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è°ƒç”¨initç¨‹åºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œinitæ˜¯ç”¨æˆ·ç©ºé—´æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªç¨‹åºã€‚</br></p>

<p>å°½ç®¡initå®Œæˆçš„å·¥ä½œä¸ç®—å¾ˆå¤šï¼Œä¸è¿‡ä»£ç è¿˜æ˜¯éå¸¸å¤æ‚çš„ã€‚<strong><em>Initç¨‹åºå¹¶ä¸æ˜¯ç”±ä¸€ä¸ªæºä»£ç æ–‡ä»¶ç»„æˆçš„</em></strong>ï¼Œè€Œæ˜¯ç”±ä¸€ç»„æºä»£ç æ–‡ä»¶çš„ç›®æ ‡æ–‡ä»¶é“¾æ¥è€Œæˆçš„ã€‚è¿™äº›æ–‡ä»¶ä½äºå¦‚ä¸‹çš„ç›®å½•ã€‚</br></p>

<p>éœ€è¦æ˜ç™½çš„æ˜¯ï¼Œè¿™äº›init.rcåªæ˜¯è¯­æ³•æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯ç¨‹åºï¼ŒçœŸæ­£çš„å…¥å£åˆ™æ˜¯ä¸Šé¢æåˆ°çš„system/core/init/init.c
å› ä¸ºinit.cæ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œåœ¨æ–‡ç« çš„ç¬¬äºŒéƒ¨åˆ†æˆ‘ä¼šç®€è¦çš„é€šè¿‡mainå‡½æ•°åˆ†æinitå¯åŠ¨æµç¨‹ï¼›</br></p>

<p>init.rcæœ‰ä¸¤ä¸ªï¼Œåˆ†åˆ«ä½äºï¼š</br>
./system/core/rootdir/init.rc</br>
./bootable/recovery/etc/init.rc</br>
ä»ç›®å½•ä¸Šå¤§è‡´å¯ä»¥çŒœæµ‹ï¼Œè¿™ä¸¤ä¸ªinit.rcä½¿ç”¨åœºæ™¯ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯åˆ·æœºç”¨åˆ°çš„ï¼Œä¹Ÿå°±æ˜¯è¿›å…¥recorveryæ¨¡å¼ï¼Œä¸€ä¸ªæ˜¯æ­£å¸¸å¯åŠ¨ç”¨åˆ°çš„ï¼›æˆ‘ä»¬è¿™é‡Œé‡ç‚¹åˆ†æçš„æ˜¯ä¸Šé¢é‚£ä¸ªï¼Œä¹Ÿæ˜¯init.cå…³è”çš„é‚£ä¸ªï¼›</p>

<h2 id="init-rcè¯­æ³•ç»“æ„è§£æ">init.rcè¯­æ³•ç»“æ„è§£æ</h2>

<p>è¦äº†è§£init.rcæ˜¯æ€ä¹ˆè§£æçš„ï¼Œæˆ‘ä»¬éœ€è¦å…ˆçœ‹çœ‹è¯´æ˜æ–‡æ¡£ï¼Œè¯´æ˜æ–‡æ¡£åœ¨ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥çœ‹ä¸‹çƒ­å¿ƒç½‘å‹çš„ä¸­æ–‡å¯¹ç…§ç‰ˆæœ¬ï¼›</br>
init.rcä½äº/bootable/recovery/etc/init.rc</p>

<p>Androidåˆå§‹åŒ–è¯­è¨€åŒ…å«äº†å››ç§ç±»å‹çš„å£°æ˜ï¼š</br>
Actionsï¼ˆè¡Œä¸ºï¼‰ã€Commandsï¼ˆå‘½ä»¤ï¼‰ã€Servicesï¼ˆæœåŠ¡ï¼‰å’ŒOptionsï¼ˆé€‰é¡¹ï¼‰</p>

<p>æ‰€æœ‰è¿™äº›éƒ½æ˜¯ä»¥è¡Œä¸ºå•ä½çš„ï¼Œå„ç§è®°å·ç”±ç©ºæ ¼æ¥éš”å¼€ã€‚</br>
Cè¯­è¨€é£æ ¼çš„åæ–œæ å·å¯ç”¨äºåœ¨è®°å·é—´æ’å…¥ç©ºæ ¼ã€‚</br>
åŒå¼•å·ä¹Ÿå¯ç”¨äºé˜²æ­¢å­—ç¬¦ä¸²è¢«ç©ºæ ¼åˆ†å‰²æˆå¤šä¸ªè®°å·ã€‚</br>
è¡Œæœ«çš„åæ–œæ ç”¨äºæŠ˜è¡Œï¼Œæ³¨é‡Šè¡Œä»¥äº•å·ï¼ˆ#ï¼‰å¼€å¤´ï¼ˆå…è®¸ä»¥ç©ºæ ¼å¼€å¤´ï¼‰ã€‚</p>

<p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåªæ˜¯ä¸€ä¸ªè¯­æ³•æ–‡ä»¶ï¼Œå°±åƒä¸€ä¸ªxmlæ–‡ä»¶ä¸€æ ·ï¼Œæ²¡æœ‰æ‰§è¡Œé¡ºåºçš„ï¼Œè§£æå™¨é€šè¿‡è¯»è¿™ä¸ªæ–‡ä»¶è·å–æƒ³è¦çš„æ•°æ®ï¼ŒåŒ…æ‹¬serviceï¼Œactionç­‰</strong></p>

<p>Actionså’ŒServiceså£°æ˜ä¸€ä¸ªæ–°çš„åˆ†ç»„Sectionã€‚æ‰€æœ‰çš„å‘½ä»¤æˆ–é€‰é¡¹éƒ½å±äºæœ€è¿‘å£°æ˜çš„åˆ†ç»„ã€‚ä½äºç¬¬ä¸€ä¸ªåˆ†ç»„ä¹‹å‰çš„å‘½ä»¤æˆ–é€‰é¡¹å°†ä¼šè¢«å¿½ç•¥ã€‚
Actionså’ŒServicesæœ‰å”¯ä¸€çš„åå­—ã€‚å¦‚æœæœ‰é‡åçš„æƒ…å†µï¼Œç¬¬äºŒä¸ªç”³æ˜çš„å°†ä¼šè¢«ä½œä¸ºé”™è¯¯å¿½ç•¥ã€‚</p>

<h2 id="actions">Actions</h2>

<p><strong>Actionsï¼ˆè¡Œä¸ºï¼‰æ˜¯ä¸€ç³»åˆ—å‘½ä»¤çš„å¼€å§‹</strong></p>

<p>Actionsä»£è¡¨ä¸€äº›Action.Actionä»£è¡¨ä¸€ç»„å‘½ä»¤(Commands),Actionséƒ½æœ‰ä¸€ä¸ªtriggerï¼ˆè§¦å‘å™¨ï¼‰,è¯¥è§¦å‘å™¨å†³å®šäº†ä½•æ—¶æ‰§è¡Œè¿™ä¸ªAction,å³åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ‰èƒ½æ‰§è¡Œè¯¥Actionä¸­çš„å®šä¹‰å‘½ä»¤.å½“ä¸€äº›æ¡ä»¶æ»¡è¶³è§¦å‘å™¨çš„æ¡ä»¶æ—¶,è¯¥Actionä¸­å®šä¹‰çš„å‘½ä»¤ä¼šè¢«æ·»åŠ åˆ°è¦æ‰§è¡Œå‘½ä»¤é˜Ÿåˆ—çš„å°¾éƒ¨(å¦‚æœè¿™ç»„å‘½ä»¤å·²ç»åœ¨é˜Ÿåˆ—ä¸­,åˆ™ä¸ä¼šå†æ¬¡æ·»åŠ ).</p>

<p>é˜Ÿåˆ—ä¸­çš„æ¯ä¸€ä¸ªactionéƒ½è¢«ä¾æ¬¡æå–å‡ºï¼Œè€Œè¿™ä¸ªactionä¸­çš„æ¯ä¸ªcommandï¼ˆå‘½ä»¤ï¼‰åœ¨ä¸€ä¸ªActionä»é˜Ÿåˆ—ç§»é™¤æ—¶,è¯¥Actionå®šä¹‰çš„å‘½ä»¤ä¼šä¾æ¬¡è¢«æ‰§è¡Œ.</p>

<p>Actionçš„æ ¼å¼å¦‚ä¸‹:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">on &lt;trgger&gt; [&amp;&amp; &lt;trigger&gt;]*</span>
   <span class="na">&lt;command1&gt;</span>
   <span class="na">&lt;command2&gt;</span>
   <span class="na">&lt;command3&gt;</span>
   <span class="na">...</span></code></pre></td></tr></table>
</div>
</div>
<p>onåé¢è·Ÿç€ä¸€ä¸ªè§¦å‘å™¨ï¼Œå½“triggerè¢«è§¦å‘æ—¶ï¼Œcommand1ï¼Œcommand2ï¼Œcommand3ï¼Œä¼šä¾æ¬¡æ‰§è¡Œï¼Œç›´åˆ°ä¸‹ä¸€ä¸ªActionæˆ–ä¸‹ä¸€ä¸ªServiceã€‚</br></p>

<p>ç®€å•æ¥è¯´ï¼ŒActionså°±æ˜¯Androidåœ¨å¯åŠ¨æ—¶å®šä¹‰çš„ä¸€ä¸ªå¯åŠ¨è„šæœ¬ï¼Œå½“æ¡ä»¶æ»¡è¶³æ—¶ï¼Œä¼šæ‰§è¡Œè¯¥è„šæœ¬ï¼Œè„šæœ¬é‡Œéƒ½æ˜¯ä¸€äº›å‘½ä»¤commandsï¼Œä¸åŒçš„è„šæœ¬ç”¨onæ¥åŒºåˆ†ã€‚</br></p>

<h2 id="triggers-è§¦å‘å™¨">Triggersï¼ˆè§¦å‘å™¨ï¼‰</h2>

<p>triggerå³æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„è§¦å‘å™¨,æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,èƒ½å¤ŸåŒ¹é…æŸç§åŒ…å«è¯¥å­—ç¬¦ä¸²çš„äº‹ä»¶.</br>
triggeråˆè¢«ç»†åˆ†ä¸ºäº‹ä»¶è§¦å‘å™¨(event trigger)å’Œå±æ€§è§¦å‘å™¨(property trigger).</br>
Triggersï¼ˆè§¦å‘å™¨ï¼‰æ˜¯ä¸€ä¸ªç”¨äºåŒ¹é…ç‰¹å®šäº‹ä»¶ç±»å‹çš„å­—ç¬¦ä¸²ï¼Œç”¨äºä½¿Actionså‘ç”Ÿã€‚</br></p>

<p>äº‹ä»¶è§¦å‘å™¨å¯ç”±â€triggerâ€å‘½ä»¤æˆ–åˆå§‹åŒ–è¿‡ç¨‹ä¸­é€šè¿‡QueueEventTrigger()è§¦å‘,é€šå¸¸æ˜¯ä¸€äº›äº‹å…ˆå®šä¹‰çš„ç®€å•å­—ç¬¦ä¸²,
ä¾‹å¦‚:boot,late-init</br>
å±æ€§è§¦å‘å™¨æ˜¯å½“æŒ‡å®šå±æ€§çš„å˜é‡å€¼å˜æˆæŒ‡å®šå€¼æ—¶è§¦å‘,å…¶æ ¼å¼ä¸ºproperty:=*</p>

<p>ä¸€ä¸ªActionå¯ä»¥æœ‰å¤šä¸ªå±æ€§è§¦å‘å™¨,ä½†æ˜¯æœ€å¤šæœ‰ä¸€ä¸ªäº‹ä»¶è§¦å‘å™¨.ä¸‹é¢æˆ‘ä»¬çœ‹ä¸¤ä¸ªä¾‹å­:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">on boot &amp;&amp; property:a</span><span class="o">=</span><span class="s">b</span></code></pre></td></tr></table>
</div>
</div>
<p>è¯¥Actionåªæœ‰åœ¨bootäº‹ä»¶å‘ç”Ÿæ—¶,å¹¶ä¸”å±æ€§aå’Œbç›¸ç­‰çš„æƒ…å†µä¸‹æ‰ä¼šè¢«è§¦å‘.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">on property:a</span><span class="o">=</span><span class="s">b &amp;&amp; property:c=d</span></code></pre></td></tr></table>
</div>
</div>
<p>è¯¥Actionä¼šåœ¨ä»¥ä¸‹ä¸‰ç§æƒ…å†µè¢«è§¦å‘:</p>

<ul>
<li>åœ¨å¯åŠ¨æ—¶,å¦‚æœå±æ€§açš„å€¼ç­‰äºbå¹¶ä¸”å±æ€§cçš„å€¼ç­‰äºd</li>
<li>åœ¨å±æ€§cçš„å€¼å·²ç»æ˜¯dçš„æƒ…å†µä¸‹,å±æ€§açš„å€¼è¢«æ›´æ–°ä¸ºb</li>
<li>åœ¨å±æ€§açš„å€¼å·²ç»æ˜¯bçš„æƒ…å†µä¸‹,å±æ€§cçš„å€¼è¢«æ›´æ–°ä¸ºd</li>
</ul>

<p>å½“å‰AILä¸­å¸¸ç”¨çš„æœ‰ä»¥ä¸‹å‡ ç§äº‹ä»¶è§¦å‘å™¨:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">ç±»å‹                      è¯´æ˜</span>
<span class="na">-------------------------------------------------</span>
<span class="na">boot                    init.rcè¢«è£…è½½åè§¦å‘</span>
<span class="na">device-added-&lt;path&gt;     æŒ‡å®šè®¾å¤‡è¢«æ·»åŠ æ—¶è§¦å‘</span>
<span class="na">device-removed-&lt;path&gt;   æŒ‡å®šè®¾å¤‡è¢«ç§»é™¤æ—¶è§¦å‘</span>
<span class="na">service-exited-&lt;name&gt;   åœ¨ç‰¹å®šæœåŠ¡(service)é€€å‡ºæ—¶è§¦å‘</span>
<span class="na">early-init              åˆå§‹åŒ–ä¹‹å‰è§¦å‘</span>
<span class="na">late-init               åˆå§‹åŒ–ä¹‹åè§¦å‘</span>
<span class="na">init                    åˆå§‹åŒ–æ—¶è§¦å‘ï¼ˆåœ¨ /init.conf ï¼ˆå¯åŠ¨é…ç½®æ–‡ä»¶ï¼‰è¢«è£…è½½ä¹‹åï¼‰</span></code></pre></td></tr></table>
</div>
</div>
<p>Initçš„è§¦å‘æ˜¯ç”±init.cé‡Œçš„å‡½æ•°action_for_each_triggeræ¥å†³å®šçš„ï¼ˆåœ¨mainå‡½æ•°ä¸­è¢«è°ƒç”¨ï¼‰ã€‚</p>

<h2 id="services">Services</h2>

<p>Servicesï¼ˆæœåŠ¡ï¼‰æ˜¯ä¸€ä¸ªç¨‹åºï¼Œä»¥ serviceå¼€å¤´ï¼Œç”±initè¿›ç¨‹å¯åŠ¨ï¼Œä¸€èˆ¬è¿è¡Œäºå¦å¤–ä¸€ä¸ªinitçš„å­è¿›ç¨‹ï¼Œæ‰€ä»¥å¯åŠ¨serviceå‰éœ€è¦åˆ¤æ–­å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚initç”Ÿæˆçš„å­è¿›ç¨‹ï¼Œå®šä¹‰åœ¨rcæ–‡ä»¶ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªserviceï¼Œåœ¨å¯åŠ¨æ—¶ä¼šé€šè¿‡forkæ–¹å¼ç”Ÿæˆå­è¿›ç¨‹ã€‚Servicesï¼ˆæœåŠ¡ï¼‰çš„å½¢å¼å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">service &lt;name&gt; &lt;pathname&gt; [ &lt;argument&gt; ]*</span>
    <span class="na">&lt;option&gt;</span>
    <span class="na">&lt;option&gt;</span>
    <span class="na">...</span></code></pre></td></tr></table>
</div>
</div>
<p>å…¶ä¸­ï¼š</p>

<ul>
<li>name:æœåŠ¡å</li>
<li>pathname:å½“å‰æœåŠ¡å¯¹åº”çš„ç¨‹åºä½ç½®</li>
<li>optionï¼šå½“å‰æœåŠ¡è®¾ç½®çš„é€‰é¡¹</li>
<li>argument å¯é€‰å‚æ•°</li>
</ul>

<h2 id="init-rcæ–‡ä»¶è¯¦è§£">init.rcæ–‡ä»¶è¯¦è§£</h2>

<p>ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œæˆ‘æŠŠæ•´ä¸ªinit.rcè§£æä¸€è¾¹ï¼Œä¾¿äºå¤§å®¶äº†è§£æ•´ä¸ªæµç¨‹ï¼›å¦‚æœæƒ³è¦äº†è§£recoveryä¸‹çš„initè¯­æ³•è§£æï¼Œå‚è€ƒè¿™ç¯‡æ–‡ç« ã€Šrecoveryä¸‹çš„init.rcè¯­æ³•è§£æã€‹</br>
ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œå¦‚æœè§‰å¾—çœ‹èµ·æ¥è´¹åŠ²ï¼Œå¯ä»¥æŒ‘ç»¿è‰²éƒ¨åˆ†çœ‹ï¼›</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ini" data-lang="ini"><span class="na">ä»£ç é‡æ¯”è¾ƒå¤§ï¼Œå¦‚æœè§‰å¾—çœ‹èµ·æ¥è´¹åŠ²ï¼Œå¯ä»¥æŒ‘ç»¿è‰²éƒ¨åˆ†çœ‹ï¼›</span>

<span class="c1"># Copyright (C) 2012 The Android Open Source Project</span>
<span class="c1">#</span>
<span class="c1"># IMPORTANT: Do not create world writable files or directories.</span>
<span class="c1"># This is a common source of Android security bugs.</span>
<span class="c1">#</span>

<span class="na">&#34;ã€import &lt;filename&gt;ä¸€ä¸ªinité…ç½®æ–‡ä»¶ï¼Œæ‰©å±•å½“å‰é…ç½®ã€‚ã€‘&#34;</span>
<span class="na">import /init.environ.rc</span>
<span class="na">import /init.usb.rc</span>
<span class="na">import /init.${ro.hardware}.rc</span>
<span class="na">import /init.${ro.zygote}.rc</span>
<span class="na">import /init.trace.rc</span>

<span class="na">&#34;ã€è§¦å‘æ¡ä»¶early-initï¼Œåœ¨early-inité˜¶æ®µè°ƒç”¨ä»¥ä¸‹è¡Œã€‘&#34;</span>
<span class="na">on early-init</span>
    <span class="c1"># Set init and its forked children&#39;s oom_adj.</span>
    <span class="na">write /proc/1/oom_score_adj -1000</span>
    <span class="na">&#34;ã€æ‰“å¼€è·¯å¾„ä¸º&lt;path&gt;çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œå¹¶å†™å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå­—ç¬¦ä¸²ã€‘&#34;</span>
    <span class="c1"># Apply strict SELinux checking of PROT_EXEC on mmap/mprotect calls.</span>
    <span class="na">write /sys/fs/selinux/checkreqprot 0</span>

    <span class="c1"># Set the security context for the init process.</span>
    <span class="c1"># This should occur before anything else (e.g. ueventd) is started.</span>
    <span class="na">&#34;ã€è¿™æ®µè„šæœ¬çš„æ„æ€æ˜¯initè¿›ç¨‹å¯åŠ¨ä¹‹åå°±é©¬ä¸Šè°ƒç”¨å‡½æ•°setconå°†è‡ªå·±çš„å®‰å…¨ä¸Šä¸‹æ–‡è®¾ç½®ä¸ºâ€œu:r:init:s0â€ï¼Œå³å°†initè¿›ç¨‹çš„domainæŒ‡å®šä¸ºinitã€‚ã€‘&#34;</span>
    <span class="na">setcon u:r:init:s0</span>

    <span class="c1"># Set the security context of /adb_keys if present.</span>
    <span class="na">&#34;ã€æ¢å¤æŒ‡å®šæ–‡ä»¶åˆ°file_contextsé…ç½®ä¸­æŒ‡å®šçš„å®‰å…¨ä¸Šçº¿æ–‡ç¯å¢ƒã€‘&#34;</span>
    <span class="na">restorecon /adb_keys</span>

    <span class="na">&#34;ã€æ‰§è¡Œstart ueventdçš„å‘½ä»¤ã€‚ueventdæ˜¯ä¸€ä¸ªserviceåé¢æœ‰å®šä¹‰ã€‘ &#34;</span>
    <span class="na">start ueventd</span>

    <span class="na">&#34;ã€mkdir &lt;path&gt; [mode] [owner] [group]   //åˆ›å»ºä¸€ä¸ªç›®å½•&lt;path&gt;ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°æŒ‡å®šmodeã€ownerä»¥åŠgroupã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œé»˜è®¤çš„æƒé™ä¸º755ï¼Œå¹¶å±äºrootç”¨æˆ·å’Œrootç»„ã€‚ã€‘&#34;</span>
    <span class="c1"># create mountpoints</span>
    <span class="na">mkdir /mnt 0775 root system</span>

<span class="na">on init</span>
    <span class="na">&#34;ã€è®¾ç½®ç³»ç»Ÿæ—¶é’Ÿçš„åŸºå‡†,æ¯”å¦‚0ä»£è¡¨GMT,å³ä»¥æ ¼æ—å°¼æ²»æ—¶é—´ä¸ºå‡†ã€‘&#34;</span>
    <span class="na">sysclktz 0</span>

<span class="na">&#34;ã€è®¾ç½®kernelæ—¥å¿—ç­‰çº§ã€‘&#34;</span>
<span class="na">loglevel 6 ####</span>
    <span class="na">write /proc/bootprof &#34;INIT: on init start&#34; ####</span>

    <span class="na">&#34;ã€symlink &lt;target&gt; &lt;path&gt;    //åˆ›å»ºä¸€ä¸ªæŒ‡å‘&lt;path&gt;çš„è½¯è¿æ¥&lt;target&gt;ã€‚ã€‘&#34;</span>
    <span class="c1"># Backward compatibility</span>
    <span class="na">symlink /system/etc /etc</span>
    <span class="na">symlink /sys/kernel/debug /d</span>

    <span class="c1"># Right now vendor lives on the same filesystem as system,</span>
    <span class="c1"># but someday that may change.</span>
    <span class="na">symlink /system/vendor /vendor</span>

    <span class="na">&#34;ã€åˆ›å»ºä¸€ä¸ªç›®å½•&lt;path&gt;ï¼Œå¯ä»¥é€‰æ‹©æ€§åœ°æŒ‡å®šmodeã€ownerä»¥åŠgroupã€‚ã€‘&#34;</span>
    <span class="c1"># Create cgroup mount point for cpu accounting</span>
    <span class="na">mkdir /acct</span>
    <span class="na">mount cgroup none /acct cpuacct</span>
    <span class="na">mkdir /acct/uid</span>

    <span class="na">&#34;ã€mount &lt;type&gt; &lt;device&gt; &lt;dir&gt; [ &lt;mountoption&gt; ]   //åœ¨ç›®å½•&lt;dir&gt;æŒ‚è½½æŒ‡å®šçš„è®¾å¤‡ã€‚&lt;device&gt; å¯ä»¥æ˜¯ä»¥ mtd@name çš„å½¢å¼æŒ‡å®šä¸€ä¸ªmtdå—è®¾å¤‡ã€‚&lt;mountoption&gt;åŒ…æ‹¬ roã€rwã€remountã€noatimeã€ ...ã€‘&#34;</span>
    <span class="c1"># Create cgroup mount point for memory</span>
    <span class="na">mount tmpfs none /sys/fs/cgroup mode</span><span class="o">=</span><span class="s">0750,uid=0,gid=1000
</span><span class="s">    mkdir /sys/fs/cgroup/memory 0750 root system
</span><span class="s">    mount cgroup none /sys/fs/cgroup/memory memory
</span><span class="s">    write /sys/fs/cgroup/memory/memory.move_charge_at_immigrate 1
</span><span class="s">    &#34;ã€chown &lt;owner&gt; &lt;group&gt; &lt;path&gt;   //æ”¹å˜æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œç»„ã€‚ã€‘&#34;</span>

    <span class="na">&#34;ã€åé¢çš„ä¸€äº›è¡Œå› ä¸ºç±»ä¼¼ï¼Œå°±çœç•¥äº†ã€‘&#34;</span>
    <span class="na">.....</span>

<span class="c1"># Healthd can trigger a full boot from charger mode by signaling this</span>
<span class="c1"># property when the power button is held.</span>
<span class="na">on property:sys.boot_from_charger_mode</span><span class="o">=</span><span class="s">1
</span><span class="s">    &#34;ã€åœæ­¢æŒ‡å®šç±»åˆ«æœåŠ¡ç±»ä¸‹çš„æ‰€æœ‰å·²è¿è¡Œçš„æœåŠ¡ã€‘&#34;
</span><span class="s">    class_stop charger
</span><span class="s">    &#34;ã€è§¦å‘ä¸€ä¸ªäº‹ä»¶,å°†è¯¥actionæ’åœ¨æŸä¸ªactionä¹‹å(ç”¨äºActionæ’é˜Ÿ)ã€‘&#34;
</span><span class="s">    trigger late-init</span>

<span class="c1"># Load properties from /system/ + /factory after fs mount.</span>
<span class="na">on load_all_props_action</span>
    <span class="na">&#34;ã€ä»/systemï¼Œ/vendoråŠ è½½å±æ€§ã€‚é»˜è®¤åŒ…å«åœ¨init.rcã€‘&#34;</span>
    <span class="na">load_all_props</span>

<span class="c1"># Indicate to fw loaders that the relevant mounts are up.</span>
<span class="na">on firmware_mounts_complete</span>
    <span class="na">&#34;ã€åˆ é™¤æŒ‡å®šè·¯å¾„ä¸‹çš„æ–‡ä»¶ã€‘&#34;</span>
    <span class="na">rm /dev/.booting</span>

<span class="c1"># Mount filesystems and start core system services.</span>
<span class="na">on late-init</span>
    <span class="na">&#34;ã€è§¦å‘ä¸€ä¸ªäº‹ä»¶ã€‚ç”¨äºå°†ä¸€ä¸ªactionä¸å¦ä¸€ä¸ª actionæ’åˆ—ã€‚ã€‘&#34;</span>
    <span class="na">trigger early-fs</span>
    <span class="na">trigger fs</span>
    <span class="na">trigger post-fs</span>
    <span class="na">trigger post-fs-data</span>

    <span class="c1"># Load properties from /system/ + /factory after fs mount. Place</span>
    <span class="c1"># this in another action so that the load will be scheduled after the prior</span>
    <span class="c1"># issued fs triggers have completed.</span>
    <span class="na">trigger load_all_props_action</span>

    <span class="c1"># Remove a file to wake up anything waiting for firmware.</span>
    <span class="na">trigger firmware_mounts_complete</span>

    <span class="na">trigger early-boot</span>
    <span class="na">trigger boot</span>


<span class="na">on post-fs</span>
    <span class="na">...</span>
    <span class="na">&#34;ã€ä¸€äº›åˆ›é€ ç›®å½•ï¼Œå»ºç«‹é“¾æ¥ï¼Œæ›´æ”¹æƒé™çš„æ“ä½œï¼Œè¿™é‡Œçœç•¥ã€‘&#34;</span>

<span class="na">on post-fs-data</span>
    <span class="na">...</span>
    <span class="na">&#34;ã€ä¸€äº›åˆ›é€ ç›®å½•ï¼Œå»ºç«‹é“¾æ¥ï¼Œæ›´æ”¹æƒé™çš„æ“ä½œï¼Œè¿™é‡Œçœç•¥ã€‘&#34;</span>

    <span class="na">&#34;ã€æ¢å¤æŒ‡å®šæ–‡ä»¶åˆ°file_contextsé…ç½®ä¸­æŒ‡å®šçš„å®‰å…¨ä¸Šçº¿æ–‡ç¯å¢ƒã€‘&#34;</span>
    <span class="na">restorecon /data/mediaserver</span>

    <span class="na">&#34;ã€å°†ç³»ç»Ÿå±æ€§&lt;name&gt;çš„å€¼è®¾ç½®ä¸º&lt;value&gt;,å³ä»¥é”®å€¼å¯¹çš„æ–¹å¼è®¾ç½®ç³»ç»Ÿå±æ€§ã€‘&#34;</span>
    <span class="c1"># Reload policy from /data/security if present.</span>
    <span class="na">setprop selinux.reload_policy 1</span>

    <span class="na">&#34;ã€ä»¥é€’å½’çš„æ–¹å¼æ¢å¤æŒ‡å®šç›®å½•åˆ°file_contextsé…ç½®ä¸­æŒ‡å®šçš„å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ã€‘&#34;</span>
    <span class="c1"># Set SELinux security contexts on upgrade or policy update.</span>
    <span class="na">restorecon_recursive /data</span>

    <span class="c1"># If there is no fs-post-data action in the init.&lt;device&gt;.rc file, you</span>
    <span class="c1"># must uncomment this line, otherwise encrypted filesystems</span>
    <span class="c1"># won&#39;t work.</span>
    <span class="c1"># Set indication (checked by vold) that we have finished this action</span>
    <span class="c1">#setprop vold.post_fs_data_done 1</span>

<span class="na">on boot</span>
    <span class="na">&#34;ã€åˆå§‹åŒ–ç½‘ç»œã€‘&#34;</span>
    <span class="c1"># basic network init</span>
    <span class="na">ifup lo</span>
    <span class="na">&#34;ã€è®¾ç½®ä¸»æœºåä¸ºlocalhostã€‘&#34;</span>
    <span class="na">hostname localhost</span>
    <span class="na">&#34;ã€è®¾ç½®åŸŸålocaldomainã€‘&#34;</span>
    <span class="na">domainname localdomain</span>

    <span class="na">&#34;ã€è®¾ç½®èµ„æºé™åˆ¶ã€‘&#34;</span>
    <span class="c1"># set RLIMIT_NICE to allow priorities from 19 to -20</span>
    <span class="na">setrlimit 13 40 40</span>

    <span class="na">&#34;ã€è¿™é‡Œçœç•¥äº†ä¸€äº›chmod,chown,ç­‰æ“ä½œï¼Œä¸å¤šè§£é‡Šã€‘&#34;</span>
   <span class="na">...</span>


    <span class="c1"># Define default initial receive window size in segments.</span>
    <span class="na">setprop net.tcp.default_init_rwnd 60</span>

    <span class="na">&#34;ã€é‡å¯coreæœåŠ¡ã€‘&#34;</span>
    <span class="na">class_start core</span>

<span class="na">on nonencrypted</span>
    <span class="na">class_start main</span>
    <span class="na">class_start late_start</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_default_encryption
</span><span class="s">    start defaultcrypto</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_encryption
</span><span class="s">    start surfaceflinger
</span><span class="s">    start encrypt</span>

<span class="na">on property:sys.init_log_level</span><span class="o">=</span><span class="s">*
</span><span class="s">    loglevel ${sys.init_log_level}</span>

<span class="na">on charger</span>
    <span class="na">class_start charger</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_reset_main
</span><span class="s">    class_reset main</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_load_persist_props
</span><span class="s">    load_persist_props</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_post_fs_data
</span><span class="s">    trigger post-fs-data</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_restart_min_framework
</span><span class="s">    class_start main</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_restart_framework
</span><span class="s">    class_start main
</span><span class="s">    class_start late_start</span>

<span class="na">on property:vold.decrypt</span><span class="o">=</span><span class="s">trigger_shutdown_framework
</span><span class="s">    class_reset late_start
</span><span class="s">    class_reset main</span>

<span class="na">on property:sys.powerctl</span><span class="o">=</span><span class="s">*
</span><span class="s">    powerctl ${sys.powerctl}</span>

<span class="c1"># system server cannot write to /proc/sys files,</span>
<span class="c1"># and chown/chmod does not work for /proc/sys/ entries.</span>
<span class="c1"># So proxy writes through init.</span>
<span class="na">on property:sys.sysctl.extra_free_kbytes</span><span class="o">=</span><span class="s">*
</span><span class="s">    write /proc/sys/vm/extra_free_kbytes ${sys.sysctl.extra_free_kbytes}</span>

<span class="c1"># &#34;tcp_default_init_rwnd&#34; Is too long!</span>
<span class="na">on property:sys.sysctl.tcp_def_init_rwnd</span><span class="o">=</span><span class="s">*
</span><span class="s">    write /proc/sys/net/ipv4/tcp_default_init_rwnd ${sys.sysctl.tcp_def_init_rwnd}</span>

<span class="na">&#34;ã€å®ˆæŠ¤è¿›ç¨‹ã€‘&#34;</span>
<span class="c1">## Daemon processes to be run by init.</span>
<span class="c1">##</span>
<span class="na">service ueventd /sbin/ueventd</span>
    <span class="na">class core</span>
    <span class="na">critical</span>
    <span class="na">seclabel u:r:ueventd:s0</span>

<span class="na">&#34;ã€æ—¥å¿—æœåŠ¡è¿›ç¨‹ã€‘&#34;</span>
<span class="na">service logd /system/bin/logd</span>
    <span class="na">class core</span>
    <span class="na">socket logd stream 0666 logd logd</span>
    <span class="na">socket logdr seqpacket 0666 logd logd</span>
    <span class="na">socket logdw dgram 0222 logd logd</span>
    <span class="na">seclabel u:r:logd:s0</span>

<span class="na">&#34;ã€Healthdæ˜¯android4.4ä¹‹åæå‡ºæ¥çš„ä¸€ç§ä¸­ä»‹æ¨¡å‹ï¼Œè¯¥æ¨¡å‹å‘ä¸‹ç›‘å¬æ¥è‡ªåº•å±‚çš„ç”µæ± äº‹ä»¶ï¼Œå‘ä¸Šä¼ é€’ç”µæ± æ•°æ®ä¿¡æ¯ç»™Frameworkå±‚çš„BatteryServiceç”¨ä»¥è®¡ç®—ç”µæ± ç”µé‡ç›¸å…³çŠ¶æ€ä¿¡æ¯ã€‘&#34;</span>
<span class="na">service healthd /sbin/healthd</span>
    <span class="na">class core</span>
    <span class="na">critical</span>
    <span class="na">seclabel u:r:healthd:s0</span>

<span class="na">&#34;ã€æ§åˆ¶å°è¿›ç¨‹ã€‘&#34;</span>
<span class="na">service console /system/bin/sh</span>
    <span class="na">&#34;ã€ä¸ºå½“å‰serviceè®¾å®šä¸€ä¸ªç±»åˆ«.ç›¸åŒç±»åˆ«çš„æœåŠ¡å°†ä¼šåŒæ—¶å¯åŠ¨æˆ–è€…åœæ­¢,é»˜è®¤ç±»åæ˜¯defaultã€‘&#34;</span>
    <span class="na">class core</span>
    <span class="na">&#34;ã€æœåŠ¡éœ€è¦ä¸€ä¸ªæ§åˆ¶å°ã€‘&#34;</span>
    <span class="na">console</span>
    <span class="na">&#34;ã€æœåŠ¡ä¸ä¼šè‡ªåŠ¨å¯åŠ¨,å¿…é¡»é€šè¿‡æœåŠ¡åæ˜¾å¼å¯åŠ¨ã€‘&#34;</span>
    <span class="na">disabled</span>
    <span class="na">&#34;ã€åœ¨æ‰§è¡Œæ­¤æœåŠ¡ä¹‹å‰åˆ‡æ¢ç”¨æˆ·å,å½“å‰é»˜è®¤çš„æ˜¯root.è‡ªAndroid Må¼€å§‹,å³ä½¿å®ƒè¦æ±‚linux capabilities,ä¹Ÿåº”è¯¥ä½¿ç”¨è¯¥é€‰é¡¹.å¾ˆæ˜æ˜¾,ä¸ºäº†è·å¾—è¯¥åŠŸèƒ½,è¿›ç¨‹éœ€è¦ä»¥rootç”¨æˆ·è¿è¡Œã€‘&#34;</span>
    <span class="na">user shell</span>
    <span class="na">seclabel u:rğŸšs0</span>

<span class="na">on property:ro.debuggable</span><span class="o">=</span><span class="s">1
</span><span class="s">    start console</span>

<span class="c1"># adbd is controlled via property triggers in init.&lt;platform&gt;.usb.rc</span>
<span class="na">service adbd /sbin/adbd --root_seclabel</span><span class="o">=</span><span class="s">u:r:su:s0
</span><span class="s">    class core
</span><span class="s">    &#34;ã€åˆ›å»ºä¸€ä¸ªunixåŸŸä¸‹çš„socket,å…¶è¢«å‘½å/dev/socket/&lt;name&gt;. å¹¶å°†å…¶æ–‡ä»¶æè¿°ç¬¦fdè¿”å›ç»™æœåŠ¡è¿›ç¨‹.å…¶ä¸­,typeå¿…é¡»ä¸ºdgram,streamæˆ–è€…seqpacke,userå’Œgroupé»˜è®¤æ˜¯0.seclabelæ˜¯è¯¥socketçš„SELLinuxçš„å®‰å…¨ä¸Šä¸‹æ–‡ç¯å¢ƒ,é»˜è®¤æ˜¯å½“å‰serviceçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ,é€šè¿‡seclabelæŒ‡å®šã€‘&#34;
</span><span class="s">    socket adbd stream 660 system system
</span><span class="s">    disabled
</span><span class="s">    seclabel u:r:adbd:s0</span>

<span class="c1"># adbd on at boot in emulator</span>
<span class="na">on property:ro.kernel.qemu</span><span class="o">=</span><span class="s">1
</span><span class="s">    start adbd</span>

<span class="na">&#34;ã€å†…å­˜ç®¡ç†æœåŠ¡ï¼Œå†…å­˜ä¸å¤Ÿé‡Šæ”¾å†…å­˜ã€‘&#34;</span>
<span class="na">service lmkd /system/bin/lmkd</span>
    <span class="na">class core</span>
    <span class="na">critical</span>
    <span class="na">socket lmkd seqpacket 0660 system system</span>

<span class="na">&#34;ã€ServiceManageræ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒç»´æŠ¤ç€ç³»ç»ŸæœåŠ¡å’Œå®¢æˆ·ç«¯çš„binderé€šä¿¡ã€‚</span>
<span class="na">åœ¨Androidç³»ç»Ÿä¸­ç”¨åˆ°æœ€å¤šçš„é€šä¿¡æœºåˆ¶å°±æ˜¯Binderï¼ŒBinderä¸»è¦ç”±Clientã€Serverã€ServiceManagerå’ŒBinderé©±åŠ¨ç¨‹åºç»„æˆã€‚å…¶ä¸­Clientã€Serviceå’ŒServiceManagerè¿è¡Œåœ¨ç”¨æˆ·ç©ºé—´ï¼Œè€ŒBinderé©±åŠ¨ç¨‹åºè¿è¡Œåœ¨å†…æ ¸ç©ºé—´ã€‚æ ¸å¿ƒç»„ä»¶å°±æ˜¯Binderé©±åŠ¨ç¨‹åºäº†ï¼Œè€ŒServiceManageræä¾›è¾…åŠ©ç®¡ç†çš„åŠŸèƒ½ï¼Œæ— è®ºæ˜¯Clientè¿˜æ˜¯Serviceè¿›è¡Œé€šä¿¡å‰é¦–å…ˆè¦å’ŒServiceManagerå–å¾—è”ç³»ã€‚è€ŒServiceManageræ˜¯ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç†Serverå¹¶å‘Clientæä¾›æŸ¥è¯¢Serverçš„åŠŸèƒ½ã€‚ã€‘&#34;</span>
<span class="na">service servicemanager /system/bin/servicemanager</span>
    <span class="na">class core</span>
    <span class="na">user system</span>
    <span class="na">group system</span>
    <span class="na">critical</span>
    <span class="na">onrestart restart healthd</span>
    <span class="na">&#34;ã€servicemanager æœåŠ¡å¯åŠ¨æ—¶ä¼šé‡å¯zygoteæœåŠ¡ã€‘&#34;</span>
    <span class="na">onrestart restart zygote</span>
    <span class="na">onrestart restart media</span>
    <span class="na">onrestart restart surfaceflinger</span>
    <span class="na">onrestart restart drm</span>

<span class="na">&#34;ã€Voldæ˜¯Volume Daemonçš„ç¼©å†™,å®ƒæ˜¯Androidå¹³å°ä¸­å¤–éƒ¨å­˜å‚¨ç³»ç»Ÿçš„ç®¡æ§ä¸­å¿ƒ,æ˜¯ç®¡ç†å’Œæ§åˆ¶Androidå¹³å°å¤–éƒ¨å­˜å‚¨è®¾å¤‡çš„åå°è¿›ç¨‹ã€‘&#34;</span>
<span class="na">service vold /system/bin/vold</span>
    <span class="na">class core</span>
    <span class="na">socket vold stream 0660 root mount</span>
    <span class="na">ioprio be 2</span>

<span class="na">&#34;ã€Netdæ˜¯Androidç³»ç»Ÿä¸­ä¸“é—¨è´Ÿè´£ç½‘ç»œç®¡ç†å’Œæ§åˆ¶çš„åå°daemonç¨‹åºã€‘&#34;</span>
<span class="na">service netd /system/bin/netd</span>
    <span class="na">class main</span>
    <span class="na">socket netd stream 0660 root system</span>
    <span class="na">socket dnsproxyd stream 0660 root inet</span>
    <span class="na">socket mdns stream 0660 root system</span>
    <span class="na">socket fwmarkd stream 0660 root inet</span>

<span class="na">&#34;ã€debuggerdæ˜¯ä¸€ä¸ªdaemonè¿›ç¨‹ï¼Œåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶éšç€initè¿›ç¨‹å¯åŠ¨ã€‚ä¸»è¦è´Ÿè´£å°†è¿›ç¨‹è¿è¡Œæ—¶çš„ä¿¡æ¯dumpåˆ°æ–‡ä»¶æˆ–è€…æ§åˆ¶å°ä¸­ã€‘&#34;</span>
<span class="na">service debuggerd /system/bin/debuggerd</span>
    <span class="na">class main</span>

<span class="na">service debuggerd64 /system/bin/debuggerd64</span>
    <span class="na">class main</span>

<span class="na">&#34;ã€Android RIL (Radio Interface Layer)æä¾›äº†TelephonyæœåŠ¡å’ŒRadioç¡¬ä»¶ä¹‹é—´çš„æŠ½è±¡å±‚ã€‘&#34;</span>
<span class="c1"># for using TK init.modem.rc rild-daemon setting</span>
<span class="c1">#service ril-daemon /system/bin/rild</span>
<span class="c1">#    class main</span>
<span class="c1">#    socket rild stream 660 root radio</span>
<span class="c1">#    socket rild-debug stream 660 radio system</span>
<span class="c1">#    user root</span>
<span class="c1">#    group radio cache inet misc audio log</span>

<span class="na">&#34;ã€æä¾›ç³»ç»Ÿ èŒƒå›´å†…çš„surface composeråŠŸèƒ½ï¼Œå®ƒèƒ½å¤Ÿå°†å„ç§åº”ç”¨ ç¨‹åºçš„2Dã€3D surfaceè¿›è¡Œç»„åˆã€‚ã€‘&#34;</span>
<span class="na">service surfaceflinger /system/bin/surfaceflinger</span>
    <span class="na">class core</span>
    <span class="na">user system</span>
    <span class="na">group graphics drmrpc</span>
    <span class="na">onrestart restart zygote</span>

<span class="na">&#34;ã€DRMå¯ä»¥ç›´æ¥è®¿é—®DRM clientsçš„ç¡¬ä»¶ã€‚DRMé©±åŠ¨ç”¨æ¥å¤„ç†DMAï¼Œå†…å­˜ç®¡ç†ï¼Œèµ„æºé”ä»¥åŠå®‰å…¨ç¡¬ä»¶è®¿é—®ã€‚ä¸ºäº†åŒæ—¶æ”¯æŒå¤šä¸ª3Dåº”ç”¨ï¼Œ3Då›¾å½¢å¡ç¡¬ä»¶å¿…é¡»ä½œä¸ºä¸€ä¸ªå…±äº«èµ„æºï¼Œå› æ­¤éœ€è¦é”æ¥æä¾›äº’æ–¥è®¿é—®ã€‚DMAä¼ è¾“å’ŒAGPæ¥å£ç”¨æ¥å‘é€å›¾å½¢æ“ä½œçš„buffersåˆ°æ˜¾å¡ç¡¬ä»¶ï¼Œå› æ­¤è¦é˜²æ­¢å®¢æˆ·ç«¯è¶Šæƒè®¿é—®æ˜¾å¡ç¡¬ä»¶ã€‚ã€‘&#34;</span>
<span class="c1">#make sure drm server has rights to read and write sdcard ####</span>
<span class="na">service drm /system/bin/drmserver</span>
    <span class="na">class main</span>
    <span class="na">user drm</span>
    <span class="c1"># group drm system inet drmrpc ####</span>
    <span class="na">group drm system inet drmrpc sdcard_r ####</span>

<span class="na">&#34;ã€åª’ä½“æœåŠ¡ï¼Œæ— éœ€å¤šè¯´ã€‘&#34;</span>
<span class="na">service media /system/bin/mediaserver</span>
    <span class="na">class main</span>
    <span class="na">user root ####</span>
<span class="c1">#   google default ####</span>
<span class="c1">#   user media    ####</span>
    <span class="na">group audio camera inet net_bt net_bt_admin net_bw_acct drmrpc mediadrm media sdcard_r system net_bt_stack ####</span>
<span class="c1">#   google default ####</span>
<span class="c1">#   group audio camera inet net_bt net_bt_admin net_bw_acct drmrpc mediadrm ####</span>

    <span class="na">ioprio rt 4</span>

<span class="na">&#34;ã€è®¾å¤‡åŠ å¯†ç›¸å…³æœåŠ¡ã€‘&#34;</span>
<span class="c1"># One shot invocation to deal with encrypted volume.</span>
<span class="na">service defaultcrypto /system/bin/vdc --wait cryptfs mountdefaultencrypted</span>
    <span class="na">disabled</span>
    <span class="na">&#34;ã€å½“æœåŠ¡é€€å‡ºæ—¶,ä¸é‡å¯è¯¥æœåŠ¡ã€‘&#34;</span>
    <span class="na">oneshot</span>
    <span class="c1"># vold will set vold.decrypt to trigger_restart_framework (default</span>
    <span class="c1"># encryption) or trigger_restart_min_framework (other encryption)</span>

<span class="c1"># One shot invocation to encrypt unencrypted volumes</span>
<span class="na">service encrypt /system/bin/vdc --wait cryptfs enablecrypto inplace default</span>
    <span class="na">disabled</span>
    <span class="na">oneshot</span>
    <span class="c1"># vold will set vold.decrypt to trigger_restart_framework (default</span>
    <span class="c1"># encryption)</span>

<span class="na">&#34;ã€å¼€æœºåŠ¨ç”»æœåŠ¡ã€‘&#34;</span>
<span class="na">service bootanim /system/bin/bootanimation</span>
    <span class="na">class core</span>
    <span class="na">user graphics</span>
<span class="c1">#    group graphics audio ####</span>
    <span class="na">group graphics media audio ####</span>
    <span class="na">disabled</span>
    <span class="na">oneshot</span>

<span class="na">&#34;ã€åœ¨Androidç³»ç»Ÿä¸­ï¼ŒPackageManagerServiceç”¨äºç®¡ç†ç³»ç»Ÿä¸­çš„æ‰€æœ‰å®‰è£…åŒ…ä¿¡æ¯åŠåº”ç”¨ç¨‹åºçš„å®‰è£…å¸è½½ï¼Œä½†æ˜¯åº”ç”¨ç¨‹åºçš„å®‰è£…ä¸å¸è½½å¹¶éPackageManagerServiceæ¥å®Œæˆï¼Œè€Œæ˜¯é€šè¿‡PackageManagerServiceæ¥è®¿é—®installdæœåŠ¡æ¥æ‰§è¡Œç¨‹åºåŒ…çš„å®‰è£…ä¸å¸è½½çš„ã€‚ã€‘&#34;</span>
<span class="na">service installd /system/bin/installd</span>
    <span class="na">class main</span>
    <span class="na">socket installd stream 600 system system</span>

<span class="na">service flash_recovery /system/bin/install-recovery.sh</span>
    <span class="na">class main</span>
    <span class="na">seclabel u:r:install_recovery:s0</span>
    <span class="na">oneshot</span>

<span class="na">&#34;ã€vpnç›¸å…³çš„æœåŠ¡ã€‘&#34;</span>
<span class="na">service racoon /system/bin/racoon</span>
    <span class="na">class main</span>
    <span class="na">socket racoon stream 600 system system</span>
    <span class="c1"># IKE uses UDP port 500. Racoon will setuid to vpn after binding the port.</span>
    <span class="na">group vpn net_admin inet</span>
    <span class="na">disabled</span>
    <span class="na">oneshot</span>

<span class="na">&#34;ã€androidä¸­æœ‰mtpdå‘½ä»¤å¯ä»¥è¿æ¥vpnã€‘&#34;</span>
<span class="na">service mtpd /system/bin/mtpd</span>
    <span class="na">class main</span>
    <span class="na">socket mtpd stream 600 system system</span>
    <span class="na">user vpn</span>
    <span class="na">group vpn net_admin inet net_raw</span>
    <span class="na">disabled</span>
    <span class="na">oneshot</span>

<span class="na">service keystore /system/bin/keystore /data/misc/keystore</span>
    <span class="na">class main</span>
    <span class="na">user keystore</span>
    <span class="na">group keystore drmrpc</span>

<span class="na">&#34;ã€å¯ä»¥ç”¨dumpstate è·å–è®¾å¤‡çš„å„ç§ä¿¡æ¯ã€‘&#34;</span>
<span class="na">service dumpstate /system/bin/dumpstate -s</span>
    <span class="na">class main</span>
    <span class="na">socket dumpstate stream 0660 shell log</span>
    <span class="na">disabled</span>
    <span class="na">oneshot</span>

<span class="na">&#34;ã€mdnsd æ˜¯å¤šæ’­ DNS å’Œ DNS æœåŠ¡å‘ç°çš„å®ˆæŠ¤ç¨‹åºã€‚ã€‘&#34;</span>
<span class="na">service mdnsd /system/bin/mdnsd</span>
    <span class="na">class main</span>
    <span class="na">user mdnsr</span>
    <span class="na">group inet net_raw</span>
    <span class="na">socket mdnsd stream 0660 mdnsr inet</span>
    <span class="na">disabled</span>
    <span class="na">oneshot</span>

<span class="na">&#34;ã€è§¦å‘å…³æœºæµç¨‹ç»§ç»­å¾€ä¸‹èµ°ã€‘&#34;</span>
<span class="na">service pre-recovery /system/bin/uncrypt</span>
    <span class="na">class main</span>
    <span class="na">disabled</span>
    <span class="na">&#34;ã€å½“æœåŠ¡é€€å‡ºæ—¶,ä¸é‡å¯è¯¥æœåŠ¡ã€‘&#34;</span>
    <span class="na">oneshot</span></code></pre></td></tr></table>
</div>
</div>
<h2 id="init-cå…¨è§£æ">init.cå…¨è§£æ</h2>

<p>æ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“åˆ†æä»¥ä¸‹è¿™ä¸ªmainå‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼›å¯èƒ½æ¯”è¾ƒé•¿ï¼Œå¤§å®¶è€å¿ƒçœ‹ä¸€ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span> <span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span> <span class="p">)</span>
<span class="p">{</span>
    <span class="cp">#åˆ› å»ºä¸€äº›linuxæ ¹æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•
</span><span class="cp"></span>    <span class="n">mkdir</span><span class="p">(</span> <span class="s">&#34;/dev&#34;</span><span class="p">,</span> <span class="mo">0755</span> <span class="p">);</span>
    <span class="n">mkdir</span><span class="p">(</span> <span class="s">&#34;/proc&#34;</span><span class="p">,</span> <span class="mo">0755</span> <span class="p">);</span>
    <span class="n">mkdir</span><span class="p">(</span> <span class="s">&#34;/sys&#34;</span><span class="p">,</span> <span class="mo">0755</span> <span class="p">);</span>

    <span class="n">mount</span><span class="p">(</span> <span class="s">&#34;tmpfs&#34;</span><span class="p">,</span> <span class="s">&#34;/dev&#34;</span><span class="p">,</span> <span class="s">&#34;tmpfs&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#34;mode=0755&#34;</span> <span class="p">);</span>
    <span class="n">mkdir</span><span class="p">(</span> <span class="s">&#34;/dev/pts&#34;</span><span class="p">,</span> <span class="mo">0755</span> <span class="p">);</span>
    <span class="n">mkdir</span><span class="p">(</span> <span class="s">&#34;/dev/socket&#34;</span><span class="p">,</span> <span class="mo">0755</span> <span class="p">);</span>
    <span class="n">mount</span><span class="p">(</span> <span class="s">&#34;devpts&#34;</span><span class="p">,</span> <span class="s">&#34;/dev/pts&#34;</span><span class="p">,</span> <span class="s">&#34;devpts&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">);</span>
    <span class="n">mount</span><span class="p">(</span> <span class="s">&#34;proc&#34;</span><span class="p">,</span> <span class="s">&#34;/proc&#34;</span><span class="p">,</span> <span class="s">&#34;proc&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">);</span>
    <span class="n">mount</span><span class="p">(</span> <span class="s">&#34;sysfs&#34;</span><span class="p">,</span> <span class="s">&#34;/sys&#34;</span><span class="p">,</span> <span class="s">&#34;sysfs&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">NULL</span> <span class="p">);</span>
    <span class="cp">#initçš„ æ ‡å‡†è¾“å…¥ï¼Œæ ‡å‡†è¾“å‡ºï¼Œæ ‡å‡†é”™è¯¯æ–‡ä»¶æè¿°ç¬¦å®šå‘åˆ°__null__ï¼Œæ„å‘³ç€æ²¡æœ‰è¾“å…¥å’Œè¾“å‡ºï¼Œå®ƒçš„è¾“å…¥å’Œè¾“å‡ºå…¨éƒ¨å†™å…¥åˆ°Logä¸­
</span><span class="cp"></span>    <span class="n">open_devnull_stdio</span><span class="p">();</span>
    <span class="cp">#åˆå§‹åŒ– log å†™å…¥initè¿› ä¿¡æ¯
</span><span class="cp"></span>    <span class="n">log_init</span><span class="p">();</span>
    <span class="cp">#è¯»å–å¹¶ ä¸”è§£æinit.rcæ–‡ä»¶ï¼ˆè¿™ä¸ªæ–‡ä»¶åœ¨æ ¹ç›®å½•ä¸‹ï¼‰
</span><span class="cp"></span>    <span class="n">parse_config_file</span><span class="p">(</span> <span class="s">&#34;/init.rc&#34;</span> <span class="p">);</span>
    <span class="cp">#å–å¾—ç¡¬ä»¶ ä¸ºæ‰“å°æˆ‘ä»¬çš„è®¾å¤‡åfs100
</span><span class="cp"></span>    <span class="n">get_hardware_name</span><span class="p">();</span>
    <span class="n">snprintf</span><span class="p">(</span> <span class="n">tmp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp</span><span class="p">),</span> <span class="s">&#34;/init.%s.rc&#34;</span><span class="p">,</span> <span class="n">hardware</span> <span class="p">);</span>
    <span class="cp">#è¯»å–å¹¶ ä¸”è§£æç¡¬ä»¶ç›¸å…³çš„initè„šæœ¬æ–‡ä»¶,
</span><span class="cp"></span>    <span class="n">parse_config_file</span><span class="p">(</span> <span class="n">tmp</span> <span class="p">);</span>
    <span class="cp">#è§¦å‘åœ¨initè„šæœ¬æ–‡ä»¶ä¸­åå­—ä¸ºearly-initçš„actionï¼Œå¹¶ä¸”æ‰§è¡Œå…¶commandsï¼Œå…¶å®æ˜¯: on early-init
</span><span class="cp"></span>    <span class="n">action_for_each_trigger</span><span class="p">(</span> <span class="s">&#34;early-init&#34;</span><span class="p">,</span> <span class="n">action_add_queue_tail</span> <span class="p">);</span>
    <span class="n">drain_action_queue</span><span class="p">();</span>
    <span class="cp">#åˆå§‹åŒ–åŠ¨æ€è®¾å¤‡ç®¡ç†ï¼Œè®¾å¤‡æ–‡ä»¶æœ‰å˜åŒ–æ—¶ååº”ç»™å†…æ ¸ï¼Œåé¢å…·ä½“è§£é‡Š
</span><span class="cp"></span>    <span class="n">device_fd</span> <span class="o">=</span> <span class="n">device_init</span><span class="p">();</span> <span class="cp"># åˆ å§‹ åŒ– è®¾ å¤‡ ç®¡ ç† åŠ¡
</span><span class="cp"></span>    <span class="cp">#åŠ è½½å¯åŠ¨åŠ¨ç”»ï¼Œå¦‚æœåŠ¨ç”»æ‰“å¼€å¤±è´¥ï¼Œåˆ™åœ¨å±å¹•ä¸Šæ‰“å°ï¼š A N D R O I Då­—æ ·ã€‚
</span><span class="cp"></span>    <span class="k">if</span> <span class="p">(</span> <span class="n">load_565rle_image</span><span class="p">(</span> <span class="n">INIT_IMAGE_FILE</span> <span class="p">)</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">fd</span> <span class="o">=</span> <span class="n">open</span><span class="p">(</span> <span class="s">&#34;/dev/tty0&#34;</span><span class="p">,</span> <span class="n">O_WRONLY</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">fd</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">msg</span><span class="p">;</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="mi">879</span>         <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span> <span class="cm">/* console is 40 cols x 30 lines */</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="s">&#34;</span><span class="se">\n</span><span class="s">&#34;</span>
                  <span class="cm">/* &#34;             A N D R O I D &#34;;å¼€æœºåŠ¨ç”» */</span>
                  <span class="n">write</span><span class="p">(</span> <span class="n">fd</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span> <span class="n">msg</span> <span class="p">)</span> <span class="p">);</span>
            <span class="n">close</span><span class="p">(</span> <span class="n">fd</span> <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="cp">#è§¦å‘ åœ¨initè„šæœ¬æ–‡ä»¶ä¸­åå­—ä¸ºinitçš„actionï¼Œå¹¶ä¸”æ‰§è¡Œå…¶commandsï¼Œå…¶å®æ˜¯ï¼šon init
</span><span class="cp"></span>    <span class="n">action_for_each_trigger</span><span class="p">(</span> <span class="s">&#34;init&#34;</span><span class="p">,</span> <span class="n">action_add_queue_tail</span> <span class="p">);</span>
    <span class="n">drain_action_queue</span><span class="p">();</span>
    <span class="cp">#å¯åŠ¨ç³»ç»Ÿå±æ€§æœåŠ¡ï¼š system property service
</span><span class="cp"></span>    <span class="n">property_set_fd</span> <span class="o">=</span> <span class="n">start_property_service</span><span class="p">();</span>
    <span class="cp">#åˆ›å»ºsocketç”¨æ¥å¤„ç†å­¤å„¿è¿›ç¨‹ä¿¡å·
</span><span class="cp"></span>    <span class="k">if</span> <span class="p">(</span> <span class="n">socketpair</span><span class="p">(</span> <span class="n">AF_UNIX</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">s</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="p">{</span>
        <span class="n">signal_fd</span>   <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
        <span class="n">signal_recv_fd</span>  <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
        <span class="n">fcntl</span><span class="p">(</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">F_SETFD</span><span class="p">,</span> <span class="n">FD_CLOEXEC</span> <span class="p">);</span>
        <span class="n">fcntl</span><span class="p">(</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">F_SETFL</span><span class="p">,</span> <span class="n">O_NONBLOCK</span> <span class="p">);</span>
        <span class="n">fcntl</span><span class="p">(</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">F_SETFD</span><span class="p">,</span> <span class="n">FD_CLOEXEC</span> <span class="p">);</span>
        <span class="n">fcntl</span><span class="p">(</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">F_SETFL</span><span class="p">,</span> <span class="n">O_NONBLOCK</span> <span class="p">);</span>
    <span class="p">}</span>
    <span class="cp">#è§¦å‘ åœ¨initè„šæœ¬æ–‡ä»¶ä¸­åå­—ä¸ºearly-bootå’Œbootçš„actionï¼Œå¹¶ä¸”æ‰§è¡Œå…¶commandsï¼Œå…¶å®æ˜¯ï¼šon early-bootå’Œon boot
</span><span class="cp"></span>    <span class="n">action_for_each_trigger</span><span class="p">(</span> <span class="s">&#34;early-boot&#34;</span><span class="p">,</span> <span class="n">action_add_queue_tail</span> <span class="p">);</span>
    <span class="n">action_for_each_trigger</span><span class="p">(</span> <span class="s">&#34;boot&#34;</span><span class="p">,</span> <span class="n">action_add_queue_tail</span> <span class="p">);</span>
    <span class="n">drain_action_queue</span><span class="p">();</span>
    <span class="cp">#å¯åŠ¨æ‰€æœ‰å±æ€§å˜åŒ–è§¦å‘å‘½ä»¤ï¼Œå…¶å®æ˜¯ï¼š on property:ro.xx.xx=xx
</span><span class="cp"></span>    <span class="n">queue_all_property_triggers</span><span class="p">();</span>
    <span class="n">drain_action_queue</span><span class="p">();</span>
    <span class="cp">#è¿›å…¥ æ­»å¾ªç¯ï¼ˆï¼‰
</span><span class="cp"></span>    <span class="k">for</span> <span class="p">(;;</span> <span class="p">)</span>
    <span class="p">{</span>
    <span class="cp">#å¯ åŠ¨æ‰€æœ‰initè„šæœ¬ä¸­å£°æ˜çš„serviceï¼Œ
</span><span class="cp"></span>    <span class="cp">#å¦‚ ï¼š266 service servicemanager /system/bin/servicemanager
</span><span class="cp"></span>    <span class="cp">#user system
</span><span class="cp"></span>    <span class="cp">#critical
</span><span class="cp"></span>    <span class="cp">#onrestart restart zygote
</span><span class="cp"></span>    <span class="cp">#onrestart restart media
</span><span class="cp"></span>    <span class="n">restart_processes</span><span class="p">();</span>
    <span class="cp">#å¤šè·¯ç›‘å¬è®¾å¤‡ç®¡ç†ï¼Œå­è¿›ç¨‹è¿è¡ŒçŠ¶æ€ï¼Œå±æ€§æœåŠ¡
</span><span class="cp"></span>        <span class="n">nr</span> <span class="o">=</span> <span class="n">poll</span><span class="p">(</span> <span class="n">ufds</span><span class="p">,</span> <span class="n">fd_count</span><span class="p">,</span> <span class="n">timeout</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">nr</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ufds</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">revents</span> <span class="o">==</span> <span class="n">POLLIN</span> <span class="p">)</span>
        <span class="p">{</span>
            <span class="n">read</span><span class="p">(</span> <span class="n">signal_recv_fd</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span> <span class="p">);</span>
            <span class="k">while</span> <span class="p">(</span> <span class="o">!</span><span class="n">wait_for_one_process</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span>
                <span class="p">;</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">ufds</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">revents</span> <span class="o">==</span> <span class="n">POLLIN</span> <span class="p">)</span>
            <span class="n">handle_device_fd</span><span class="p">(</span> <span class="n">device_fd</span> <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span> <span class="n">ufds</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">revents</span> <span class="o">==</span> <span class="n">POLLIN</span> <span class="p">)</span>
            <span class="n">handle_property_set_fd</span><span class="p">(</span> <span class="n">property_set_fd</span> <span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span> <span class="n">ufds</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="n">revents</span> <span class="o">==</span> <span class="n">POLLIN</span> <span class="p">)</span>
            <span class="n">handle_keychord</span><span class="p">(</span> <span class="n">keychord_fd</span> <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Fantasy</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">2019-01-18</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">è®¸å¯åè®®</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://mazhidong.github.io/tags/android/">android</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/aosp/2018-12-07_android-5.1-ota%E5%8C%85%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF/">
            <span class="next-text nav-default">Android 5.1 OTAåŒ…ç¼–è¯‘é”™è¯¯</span>
            <span class="prev-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  <div class="post bg-white">
      <div id="comments-gitment"></div>
      <link rel="stylesheet" href="/lib/gitment/gitment-0.0.3.min.css">
        <script src="/lib/gitment/gitment-0.0.3.min.js"></script>
      <script type="text/javascript">
      const gitment = new Gitment({
        id: '2019-01-18_Androidç³»ç»Ÿinit.rcå…¨è§£æ.md',
        title: 'Androidç³»ç»Ÿinit.rcå…¨è§£æ',
        link: decodeURI(location.href),
        desc: 'è¿™æ˜¯ä¸€ç¯‡ç”¨å¿ƒå†™çš„åšå®¢ï¼Œä¹Ÿå¸Œæœ›å¤§å®¶ç”¨å¿ƒçœ‹å¹¶å¸®å¿™æ‰¾åˆ°æ–‡ç« çš„æ”¹è¿›ä¹‹å¤„ï¼Œè°¢è°¢ï¼› æœåŠ¡å¯åŠ¨æœºåˆ¶ system\/core\/init\/init.cæ–‡ä»¶main',
        owner: 'mazhidong',
        repo: 'comments',
        oauth: {
          client_id: 'a7ad9d79ce4e98eabdc8',
          client_secret: '13ffc9363807f8929fe31ce5a7022fb8676dab45'
        }
      })
      gitment.render('comments-gitment')
      </script>
      <noscript>Please enable JavaScript to view the <a href="https://github.com/imsun/gitment">comments powered by gitment.</a></noscript>
    </div>

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:591888356@qq.com" rel="me noopener" class="iconfont icon-email"
        title="email" target="_blank">
      </a>
      <a href="https://github.com/mazhidong" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
  <a href="https://mazhidong.github.io/index.xml" rel="noopener alternate" type="application/rss" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
  </div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2018 -
    2019
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">Fantasy</span></span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  





</body>
</html>
